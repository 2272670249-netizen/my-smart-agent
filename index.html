<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HW_Smart_Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            padding: 30px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 24px;
            font-weight: 600;
        }
        .mobile-status {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            color: #2e7d32;
            font-size: 14px;
        }
        .loading-dots:after {
            content: '';
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        /* ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ– */
        .container {
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ HW Smart Agent</h1>
        <div id="status" class="mobile-status">
            æ­£åœ¨åŠ è½½æ™ºèƒ½ä½“<span class="loading-dots"></span>
        </div>
        <div id="mobileTips" style="font-size: 12px; color: #666; margin-top: 15px; display: none;">
            ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–å·²å¯ç”¨ | å¦‚æœåŠ è½½ç¼“æ…¢è¯·è€å¿ƒç­‰å¾…
        </div>
    </div>

    <!-- Coze SDK - æ·»åŠ ç§»åŠ¨ç«¯æ£€æµ‹å’Œå¤‡ç”¨æ–¹æ¡ˆ -->
    <script>
        // æ£€æµ‹ç§»åŠ¨ç«¯
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // ç§»åŠ¨ç«¯ä¼˜åŒ–é…ç½®
        if (isMobile) {
            document.getElementById('mobileTips').style.display = 'block';
            console.log('ğŸ“± ç§»åŠ¨ç«¯è®¿é—®æ£€æµ‹');
        }

        function loadCozeSDK() {
            const statusEl = document.getElementById('status');
            let sdkLoaded = false;
            
            // æ–¹æ³•1: ä¸»è¦SDKæº
            const script = document.createElement('script');
            script.src = 'https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.19/libs/cn/index.js';
            
            // ç§»åŠ¨ç«¯è®¾ç½®æ›´é•¿çš„è¶…æ—¶æ—¶é—´
            const timeout = isMobile ? 15000 : 10000;
            const loadTimer = setTimeout(() => {
                if (!sdkLoaded) {
                    statusEl.innerHTML = 'åŠ è½½è¶…æ—¶ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ<span class="loading-dots"></span>';
                    loadFallbackSDK();
                }
            }, timeout);

            script.onload = function() {
                clearTimeout(loadTimer);
                sdkLoaded = true;
                statusEl.innerHTML = 'SDKåŠ è½½æˆåŠŸï¼Œåˆå§‹åŒ–ä¸­<span class="loading-dots"></span>';
                initializeCozeBot();
            };

            script.onerror = function() {
                clearTimeout(loadTimer);
                statusEl.innerHTML = 'ä¸»è¦æºåŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ<span class="loading-dots"></span>';
                loadFallbackSDK();
            };

            document.head.appendChild(script);
        }

        function loadFallbackSDK() {
            // å¤‡ç”¨SDKæº
            const fallbackScript = document.createElement('script');
            fallbackScript.src = 'https://lf3-cdn-tos.douyinstatic.com/obj/coze-web-sdk/coze-sdk.min.js';
            
            fallbackScript.onload = function() {
                document.getElementById('status').innerHTML = 'å¤‡ç”¨SDKåŠ è½½æˆåŠŸï¼Œåˆå§‹åŒ–ä¸­<span class="loading-dots"></span>';
                initializeCozeBot();
            };

            fallbackScript.onerror = function() {
                document.getElementById('status').innerHTML = 'âŒ æ‰€æœ‰SDKæºåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
            };

            document.head.appendChild(fallbackScript);
        }

        function initializeCozeBot() {
            try {
                const token = 'pat_iqDSBzSYUIOn9Crgna838VghoALGsD34HzAICrsZ3X5mL4dJ8ofsFxmWCYmqaqxX'; // æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®token
                
                const cozeClient = new CozeWebSDK.WebChatClient({
                    config: {
                        bot_id: '7578063729297145899',
                    },
                    auth: {
                        type: 'token',
                        token: token,
                        onRefreshToken: function() {
                            return token;
                        }
                    },
                    userInfo: {
                        id: 'user_' + Math.random().toString(36).substr(2, 9),
                        nickname: isMobile ? 'ç§»åŠ¨ç”¨æˆ·' : 'ç½‘é¡µç”¨æˆ·'
                    },
                    ui: {
                        asstBtn: {
                            isNeed: true,
                            color: '#667eea',
                            size: isMobile ? 'medium' : 'large'
                        },
                        chatBot: {
                            title: 'HW-Smart-Agent',
                            welcome: 'æ‚¨å¥½ï¼å¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚'
                        }
                    }
                });

                document.getElementById('status').innerHTML = 'âœ… æ™ºèƒ½ä½“åŠ è½½å®Œæˆï¼è¯·ç‚¹å‡»å³ä¸‹è§’å›¾æ ‡å¼€å§‹å¯¹è¯';
                
                // ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†
                if (isMobile) {
                    setTimeout(() => {
                        const tips = document.createElement('div');
                        tips.innerHTML = 'ğŸ’¡ æç¤ºï¼šå¦‚æœå›¾æ ‡ä¸æ˜¾ç¤ºï¼Œè¯·å°è¯•ä¸Šä¸‹æ»‘åŠ¨é¡µé¢';
                        tips.style.cssText = 'font-size:12px; color:#666; margin-top:10px;';
                        document.getElementById('status').appendChild(tips);
                    }, 2000);
                }

            } catch (error) {
                document.getElementById('status').innerHTML = 'âŒ åˆå§‹åŒ–å¤±è´¥: ' + error.message;
            }
        }

        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            // ç§»åŠ¨ç«¯å»¶è¿ŸåŠ è½½ï¼Œæé«˜æˆåŠŸç‡
            if (isMobile) {
                setTimeout(loadCozeSDK, 500);
            } else {
                loadCozeSDK();
            }
        });
    </script>
</body>
</html>
