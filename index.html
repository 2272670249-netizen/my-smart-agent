<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯æ™ºå¯¼å¸ˆ - è¯„ä»·æ™ºèƒ½ä½“</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 500px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .robot-icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
        }
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .status-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            border-left: 4px solid #3498db;
        }
        .status-success {
            border-left-color: #2ecc71;
            background: #e8f6ef;
        }
        .status-error {
            border-left-color: #e74c3c;
            background: #fdedec;
        }
        .chat-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            margin: 20px 0;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .hidden {
            display: none;
        }
        /* å¼ºåˆ¶æ˜¾ç¤ºæ‚¬æµ®æŒ‰é’®çš„æ ·å¼ */
        .coze-asst-btn {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            z-index: 10000 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="robot-icon">ğŸ¤–</div>
        <h1>å¯æ™ºå¯¼å¸ˆ - è¯„ä»·æ™ºèƒ½ä½“</h1>
        <p class="subtitle">åŸºäºCozeå¹³å°çš„æ™ºèƒ½å¯¹è¯åŠ©æ‰‹</p>
        
        <div id="statusBox" class="status-box status-success">
            <div style="font-size: 18px; margin-bottom: 10px;">âœ… æ™ºèƒ½ä½“å·²å°±ç»ªï¼</div>
            <div>è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹å¯¹è¯</div>
        </div>

        <button id="startChatBtn" class="chat-btn">
            <span>ğŸ’¬ å¼€å§‹å¯¹è¯</span>
        </button>

        <div style="margin-top: 20px; font-size: 14px; color: #7f8c8d;">
            <p>å¦‚æœå³ä¸‹è§’æ²¡æœ‰æ˜¾ç¤ºå›¾æ ‡ï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®</p>
        </div>
    </div>

    <!-- ä½¿ç”¨æ‚¨æä¾›çš„å¯ç”¨SDK -->
    <script src="https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.19/libs/cn/index.js"></script>
    
    <script>
        let cozeClient = null;
        let chatStarted = false;

        function initializeCozeBot() {
            try {
                const token = 'pat_iqDSBzSYUIOn9Crgna838VghoALGsD34HzAICrsZ3X5mL4dJ8ofsFxmWCYmqaqxX'; // è¯·æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®token
                
                cozeClient = new CozeWebSDK.WebChatClient({
                    config: {
                        bot_id: '7578063729297145899',
                    },
                    auth: {
                        type: 'token',
                        token: token
                    },
                    userInfo: {
                        id: 'user_' + Math.random().toString(36).substr(2, 9),
                        nickname: 'å¯æ™ºå¯¼å¸ˆç”¨æˆ·'
                    },
                    ui: {
                        asstBtn: {
                            isNeed: true,
                            color: '#667eea',
                            size: 'large'
                        },
                        chatBot: {
                            title: 'å¯æ™ºå¯¼å¸ˆ - è¯„ä»·æ™ºèƒ½ä½“',
                            welcome: 'æ‚¨å¥½ï¼æˆ‘æ˜¯å¯æ™ºå¯¼å¸ˆï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æä¾›å­¦ä¹ è¯„ä»·å’ŒæŒ‡å¯¼ã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦è¯„ä»·çš„å†…å®¹å§ï¼',
                            style: {
                                primaryColor: '#667eea'
                            }
                        }
                    }
                });

                console.log('Cozeæ™ºèƒ½ä½“åˆå§‹åŒ–æˆåŠŸ');
                
                // å¼ºåˆ¶æ˜¾ç¤ºæ‚¬æµ®æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ä½†è¢«éšè—ï¼‰
                setTimeout(() => {
                    const asstBtn = document.querySelector('.coze-asst-btn, [class*="asst-btn"], [class*="assistant"]');
                    if (asstBtn) {
                        asstBtn.style.display = 'block';
                        asstBtn.style.opacity = '1';
                        asstBtn.style.visibility = 'visible';
                    }
                }, 1000);

            } catch (error) {
                console.error('åˆå§‹åŒ–é”™è¯¯:', error);
                document.getElementById('statusBox').innerHTML = `
                    <div style="color: #e74c3c;">
                        <div style="font-size: 18px; margin-bottom: 10px;">âŒ åˆå§‹åŒ–å¤±è´¥</div>
                        <div>é”™è¯¯: ${error.message}</div>
                    </div>
                `;
            }
        }

        // æ‰‹åŠ¨æ‰“å¼€èŠå¤©çª—å£
        function openChatWindow() {
            if (!cozeClient) {
                alert('æ™ºèƒ½ä½“å°šæœªåˆå§‹åŒ–å®Œæˆï¼Œè¯·ç¨åé‡è¯•');
                return;
            }

            // å°è¯•é€šè¿‡ç¼–ç¨‹æ–¹å¼æ‰“å¼€èŠå¤©çª—å£
            try {
                // æ–¹æ³•1: è§¦å‘æ‚¬æµ®æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                const asstBtn = document.querySelector('.coze-asst-btn, [class*="asst-btn"], [class*="assistant"]');
                if (asstBtn) {
                    asstBtn.click();
                } else {
                    // æ–¹æ³•2: å¦‚æœæ‚¬æµ®æŒ‰é’®ä¸å­˜åœ¨ï¼Œæ˜¾ç¤ºæç¤º
                    alert('èŠå¤©åŠŸèƒ½å·²å°±ç»ªï¼å¦‚æœå³ä¸‹è§’æ²¡æœ‰å›¾æ ‡ï¼Œè¯·å°è¯•ï¼š\n1. åˆ·æ–°é¡µé¢\n2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯\n3. ä½¿ç”¨å…¨å±æ¨¡å¼');
                    
                    // æ–¹æ³•3: å°è¯•ç›´æ¥æ‰“å¼€iframe
                    openFullscreenChat();
                }
            } catch (error) {
                console.error('æ‰“å¼€èŠå¤©çª—å£å¤±è´¥:', error);
                openFullscreenChat();
            }
        }

        // å…¨å±èŠå¤©çª—å£å¤‡ç”¨æ–¹æ¡ˆ
        function openFullscreenChat() {
            const chatHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 10000;">
                    <div style="position: absolute; top: 10px; right: 10px;">
                        <button onclick="document.getElementById('fullscreenChat').remove()" style="padding: 10px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer;">å…³é—­</button>
                    </div>
                    <iframe src="https://www.coze.cn/embed/7558025828223778835" style="width: 100%; height: 100%; border: none;"></iframe>
                </div>
            `;
            
            const chatDiv = document.createElement('div');
            chatDiv.id = 'fullscreenChat';
            chatDiv.innerHTML = chatHTML;
            document.body.appendChild(chatDiv);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ™ºèƒ½ä½“
            setTimeout(initializeCozeBot, 500);
            
            // ç»‘å®šå¼€å§‹å¯¹è¯æŒ‰é’®äº‹ä»¶
            document.getElementById('startChatBtn').addEventListener('click', openChatWindow);
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    openChatWindow();
                }
            });
        });

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€é”™è¯¯:', e.error);
        });
    </script>
</body>
</html>
