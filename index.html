<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯æ™ºå¯¼å¸ˆ - ä¿¡æ¯ç§‘æŠ€å­¦ä¸šè¯„ä»·æ™ºèƒ½ä½“</title>
    <style>
        /* åŸæœ‰çš„æ‰€æœ‰æ ·å¼ä¿æŒä¸å˜ï¼Œåªæ·»åŠ ä»¥ä¸‹æ ·å¼ */
        
        /* ç¡®ä¿Cozeæ‚¬æµ®æŒ‰é’®å®¹å™¨æ­£å¸¸æ˜¾ç¤º */
        .coze-web-sdk-wrapper {
            z-index: 9999 !important;
        }
        
        /* é˜²æ­¢ä¸å…¶ä»–å…ƒç´ å†²çª */
        #coze-chat-container {
            position: fixed !important;
            bottom: 20px !important;
            right: 20px !important;
            z-index: 10000 !important;
        }
        
        /* ç¡®ä¿é¡µé¢å±‚çº§æ­£ç¡® */
        body {
            position: relative;
            overflow-x: hidden;
        }
    </style>
    <!-- åŸæœ‰çš„æ‰€æœ‰CSSæ ·å¼ä¿æŒä¸å˜ -->
</head>
<body>
    <div class="container">
        <!-- åŸæœ‰çš„æ‰€æœ‰HTMLç»“æ„ä¿æŒä¸å˜ -->
        
        <!-- æ·»åŠ Cozeæ‚¬æµ®æŒ‰é’®çš„ä¸“ç”¨å®¹å™¨ -->
        <div id="coze-chat-container"></div>
    </div>

    <!-- ä¼šè¯ç®¡ç†å’ŒCoze SDKè„šæœ¬ -->
    <script>
        // ========== ä¼šè¯ç®¡ç†ç³»ç»Ÿ ==========
        class SessionManager {
            constructor() {
                this.STORAGE_KEY = 'eduai_session_v4';
                this.session = null;
                this.initSession();
                this.updateSessionDisplay();
                this.bindEvents();
            }

            initSession() {
                // æ£€æŸ¥æ˜¯å¦æœ‰ç°æœ‰ä¼šè¯
                let savedSession = localStorage.getItem(this.STORAGE_KEY);
                
                if (savedSession) {
                    try {
                        this.session = JSON.parse(savedSession);
                        // æ£€æŸ¥ä¼šè¯æ˜¯å¦è¿‡æœŸï¼ˆ24å°æ—¶ï¼‰
                        const now = new Date().getTime();
                        const created = new Date(this.session.createdAt).getTime();
                        if (now - created > 24 * 60 * 60 * 1000) {
                            // ä¼šè¯è¿‡æœŸï¼Œåˆ›å»ºæ–°ä¼šè¯
                            this.createNewSession();
                        } else {
                            // æ›´æ–°æœ€åæ´»åŠ¨æ—¶é—´
                            this.session.lastActive = new Date().toISOString();
                            this.saveSession();
                        }
                    } catch (e) {
                        console.error('è§£æä¼šè¯æ•°æ®å¤±è´¥ï¼Œåˆ›å»ºæ–°ä¼šè¯', e);
                        this.createNewSession();
                    }
                } else {
                    this.createNewSession();
                }
            }

            createNewSession() {
                const deviceId = this.generateDeviceId();
                const userId = this.generateUserId();
                const sessionId = this.generateSessionId();
                
                this.session = {
                    userId: userId,
                    sessionId: sessionId,
                    deviceId: deviceId,
                    deviceType: this.getDeviceType(),
                    createdAt: new Date().toISOString(),
                    lastActive: new Date().toISOString(),
                    userAgent: navigator.userAgent.substring(0, 100)
                };
                
                this.saveSession();
            }

            generateDeviceId() {
                // ç”Ÿæˆè®¾å¤‡å”¯ä¸€ID
                const navigatorInfo = [
                    navigator.userAgent,
                    navigator.language,
                    navigator.hardwareConcurrency,
                    screen.width,
                    screen.height,
                    screen.colorDepth,
                    new Date().getTimezoneOffset()
                ].join('|');
                
                let hash = 0;
                for (let i = 0; i < navigatorInfo.length; i++) {
                    const char = navigatorInfo.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                
                return `device_${Math.abs(hash).toString(36)}`;
            }

            generateUserId() {
                const timestamp = Date.now();
                const random = Math.random().toString(36).substr(2, 12);
                return `user_${timestamp}_${random}`;
            }

            generateSessionId() {
                return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            }

            getDeviceType() {
                const ua = navigator.userAgent;
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {
                    return 'ç§»åŠ¨è®¾å¤‡';
                } else if (/Mac|Win|Linux/.test(ua)) {
                    return 'æ¡Œé¢è®¾å¤‡';
                }
                return 'æœªçŸ¥è®¾å¤‡';
            }

            saveSession() {
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.session));
            }

            clearSession() {
                localStorage.removeItem(this.STORAGE_KEY);
                this.createNewSession();
                this.updateSessionDisplay();
                alert('ä¼šè¯å·²é‡ç½®ï¼Œæ­£åœ¨é‡æ–°åˆå§‹åŒ–...');
                location.reload();
            }

            refreshSession() {
                this.session.sessionId = this.generateSessionId();
                this.session.lastActive = new Date().toISOString();
                this.saveSession();
                this.updateSessionDisplay();
                alert('å·²åˆ·æ–°ä¼šè¯IDï¼Œå½“å‰å¯¹è¯å°†é‡æ–°å¼€å§‹');
                location.reload();
            }

            updateSessionDisplay() {
                const sessionIdEl = document.getElementById('sessionId');
                const sessionTimeEl = document.getElementById('sessionTime');
                const deviceTypeEl = document.getElementById('deviceType');
                const userSessionInfoEl = document.getElementById('userSessionInfo');
                
                if (this.session && sessionIdEl) {
                    const shortSessionId = this.session.sessionId.substring(0, 16) + '...';
                    sessionIdEl.textContent = shortSessionId;
                    sessionTimeEl.textContent = new Date(this.session.createdAt).toLocaleString();
                    deviceTypeEl.textContent = this.session.deviceType;
                    
                    if (userSessionInfoEl) {
                        userSessionInfoEl.textContent = `å½“å‰ä¼šè¯ï¼š${this.session.deviceType} - ${shortSessionId}`;
                    }
                }
            }

            bindEvents() {
                const refreshBtn = document.getElementById('refreshSession');
                const clearBtn = document.getElementById('clearSession');
                
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', () => {
                        if (confirm('åˆ·æ–°ä¼šè¯å°†å¼€å§‹æ–°çš„å¯¹è¯ï¼Œä½†ä¿ç•™ç”¨æˆ·IDï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
                            this.refreshSession();
                        }
                    });
                }
                
                if (clearBtn) {
                    clearBtn.addEventListener('click', () => {
                        if (confirm('æ¸…é™¤æ‰€æœ‰ä¼šè¯æ•°æ®å°†åˆ é™¤æ‰€æœ‰èŠå¤©è®°å½•ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
                            this.clearSession();
                        }
                    });
                }
            }
        }

        // ========== å…¨å±€çŠ¶æ€ç®¡ç† ==========
        let cozeClient = null;
        let cozeSDKLoaded = false;
        let initializationAttempted = false;

        // ========== Coze SDK åˆå§‹åŒ– ==========
        function initializeCoze() {
            const statusEl = document.getElementById('status');
            if (!statusEl || initializationAttempted) {
                return; // é˜²æ­¢é‡å¤åˆå§‹åŒ–
            }
            
            initializationAttempted = true;
            
            try {
                // åˆå§‹åŒ–ä¼šè¯ç®¡ç†å™¨
                const sessionManager = new SessionManager();
                const session = sessionManager.session;

                // æ£€æŸ¥SDKæ˜¯å¦åŠ è½½
                if (typeof window.CozeWebSDK === 'undefined') {
                    console.warn('CozeWebSDKæœªå®šä¹‰ï¼Œç­‰å¾…åŠ è½½...');
                    statusEl.innerHTML = 'æ­£åœ¨åŠ è½½SDK...<span class="loading-dots"></span>';
                    setTimeout(initializeCoze, 1000); // 1ç§’åé‡è¯•
                    initializationAttempted = false;
                    return;
                }

                // ç”Ÿæˆå”¯ä¸€çš„ç”¨æˆ·æ ‡è¯†
                const userIdentifier = `${session.userId}_${session.deviceId}`;
                
                console.log('å¼€å§‹åˆå§‹åŒ–Cozeæ™ºèƒ½ä½“ï¼Œç”¨æˆ·ID:', userIdentifier);
                
                // æ¸…ç†å¯èƒ½å­˜åœ¨çš„æ—§å®ä¾‹
                if (window.cozeClientInstance) {
                    try {
                        window.cozeClientInstance.destroy && window.cozeClientInstance.destroy();
                    } catch (e) {
                        console.warn('æ¸…ç†æ—§å®ä¾‹å¤±è´¥:', e);
                    }
                    window.cozeClientInstance = null;
                }
                
                // ç¡®ä¿æœ‰å®¹å™¨å…ƒç´ 
                let container = document.getElementById('coze-chat-container');
                if (!container) {
                    container = document.createElement('div');
                    container.id = 'coze-chat-container';
                    document.body.appendChild(container);
                    console.log('åˆ›å»ºäº†Cozeå®¹å™¨å…ƒç´ ');
                }
                
                // æ£€æŸ¥å®¹å™¨æ˜¯å¦åœ¨DOMä¸­
                if (!document.body.contains(container)) {
                    document.body.appendChild(container);
                }
                
                // Coze SDKé…ç½®
                const config = {
                    config: {
                        bot_id: '7558025828223778835',
                    },
                    component: {
                        layout: {
                            type: 'full' // ä½¿ç”¨å®Œæ•´å¸ƒå±€
                        },
                        theme: {
                            primary: "#1a73e8",
                            assistant_message_bg_color: "#e8f0fe",
                            assistant_message_text_color: "#202124",
                            user_message_bg_color: "#1a73e8",
                            user_message_text_color: "#ffffff",
                            launcher_color: "#1a73e8",
                            launcher_position: {
                                bottom: '20px',
                                right: '20px'
                            }
                        },
                        launcher: {
                            is_show: true, // ç¡®ä¿æ˜¾ç¤ºæ‚¬æµ®æŒ‰é’®
                            default_open: false
                        }
                    },
                    auth: {
                        type: 'token',
                        token: 'pat_HQnW8V3BobW63uKj8qWTQ0DORkpiYKETyOGE45UiVrFZUv1clpbrPDcoasX8LJY1',
                    },
                    user: {
                        user_id: userIdentifier,
                        user_name: `å­¦ç”Ÿ_${session.userId.substring(8, 16)}`,
                        user_avatar: '',
                        custom_info: {
                            device_type: session.deviceType,
                            session_id: session.sessionId,
                            created_at: session.createdAt
                        }
                    }
                };

                // å°è¯•ä¸åŒçš„åˆå§‹åŒ–æ–¹æ³•
                try {
                    // æ–¹æ³•1: ä½¿ç”¨æ–°ç‰ˆAPI
                    if (typeof window.CozeWebSDK.create === 'function') {
                        console.log('ä½¿ç”¨CozeWebSDK.create()åˆå§‹åŒ–');
                        cozeClient = window.CozeWebSDK.create(config);
                    } 
                    // æ–¹æ³•2: ä½¿ç”¨initæ–¹æ³•
                    else if (typeof window.CozeWebSDK.init === 'function') {
                        console.log('ä½¿ç”¨CozeWebSDK.init()åˆå§‹åŒ–');
                        cozeClient = window.CozeWebSDK.init(config);
                    }
                    // æ–¹æ³•3: ç›´æ¥è°ƒç”¨
                    else if (typeof window.CozeWebSDK === 'function') {
                        console.log('ä½¿ç”¨window.CozeWebSDK()ç›´æ¥åˆå§‹åŒ–');
                        cozeClient = window.CozeWebSDK(config);
                    }
                    // æ–¹æ³•4: å°è¯•é»˜è®¤å¯¼å‡º
                    else if (window.CozeWebSDK.default) {
                        console.log('ä½¿ç”¨CozeWebSDK.defaultåˆå§‹åŒ–');
                        const SDK = window.CozeWebSDK.default;
                        if (typeof SDK.create === 'function') {
                            cozeClient = SDK.create(config);
                        } else if (typeof SDK.init === 'function') {
                            cozeClient = SDK.init(config);
                        } else if (typeof SDK === 'function') {
                            cozeClient = SDK(config);
                        } else {
                            throw new Error('æ— æ³•è¯†åˆ«çš„SDKæ ¼å¼');
                        }
                    }
                    else {
                        throw new Error('æœªæ‰¾åˆ°å¯ç”¨çš„Coze SDKåˆå§‹åŒ–æ–¹æ³•');
                    }

                    // ç­‰å¾…SDKå®Œå…¨åˆå§‹åŒ–
                    setTimeout(() => {
                        // æ£€æŸ¥æŒ‰é’®æ˜¯å¦è¢«åˆ›å»º
                        checkForChatButton();
                    }, 2000);

                    // å­˜å‚¨åˆ°å…¨å±€å˜é‡
                    window.cozeClientInstance = cozeClient;
                    
                    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                    statusEl.innerHTML = 'âœ… æ™ºèƒ½ä½“åŠ è½½å®Œæˆï¼å³ä¸‹è§’åº”æ˜¾ç¤ºæ‚¬æµ®æŒ‰é’®';
                    cozeSDKLoaded = true;
                    
                    console.log('Cozeæ™ºèƒ½ä½“åˆå§‹åŒ–æˆåŠŸ');
                    
                    // å¦‚æœ10ç§’åæŒ‰é’®è¿˜æ²¡å‡ºç°ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¼•å¯¼
                    setTimeout(() => {
                        checkForChatButton();
                    }, 10000);

                } catch (error) {
                    console.error('Cozeåˆå§‹åŒ–é”™è¯¯:', error);
                    statusEl.innerHTML = 'âŒ åˆå§‹åŒ–å¤±è´¥: ' + error.message;
                    showFallbackChatInterface();
                }

            } catch (error) {
                console.error('åˆå§‹åŒ–Cozeæ—¶å‡ºé”™:', error);
                statusEl.innerHTML = 'âŒ åˆå§‹åŒ–å¤±è´¥: ' + error.message;
                showFallbackChatInterface();
            }
        }

        // ========== æ£€æŸ¥èŠå¤©æŒ‰é’®æ˜¯å¦å­˜åœ¨ ==========
        function checkForChatButton() {
            // æŸ¥æ‰¾Cozeåˆ›å»ºçš„æŒ‰é’®å…ƒç´ 
            const cozeButtons = document.querySelectorAll('[class*="coze"], [class*="Coze"], [id*="coze"], [id*="Coze"]');
            const cozeIframes = document.querySelectorAll('iframe');
            
            console.log('æ£€æŸ¥CozeæŒ‰é’®å…ƒç´ :');
            console.log('Cozeç›¸å…³å…ƒç´ :', cozeButtons.length);
            console.log('iframeæ•°é‡:', cozeIframes.length);
            
            if (cozeButtons.length > 0 || cozeIframes.length > 0) {
                console.log('âœ… æ£€æµ‹åˆ°Cozeå…ƒç´ ');
                return true;
            }
            
            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œæ˜¾ç¤ºæ‰‹åŠ¨å¼•å¯¼
            const statusEl = document.getElementById('status');
            if (statusEl && statusEl.innerHTML.includes('âœ…')) {
                const guideDiv = document.createElement('div');
                guideDiv.style.cssText = `
                    background: #fff3cd;
                    border: 1px solid #ffeaa7;
                    border-radius: 4px;
                    padding: 10px;
                    margin-top: 10px;
                    font-size: 14px;
                    color: #856404;
                `;
                guideDiv.innerHTML = `
                    <p><strong>ğŸ’¡ å¦‚æœæ²¡çœ‹åˆ°æ‚¬æµ®æŒ‰é’®ï¼š</strong></p>
                    <ol style="margin-left: 20px; margin-top: 5px;">
                        <li>å°è¯•æ»šåŠ¨é¡µé¢åˆ°åº•éƒ¨</li>
                        <li>æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ‹¦æˆªäº†å¼¹çª—</li>
                        <li>å°è¯•åˆ·æ–°é¡µé¢</li>
                    </ol>
                `;
                statusEl.appendChild(guideDiv);
            }
            
            return false;
        }

        // ========== æ”¹è¿›çš„SDKåŠ è½½å‡½æ•° ==========
        function loadCozeSDK() {
            const statusEl = document.getElementById('status');
            if (!statusEl) return;

            // å…ˆåˆå§‹åŒ–ä¼šè¯ç®¡ç†å™¨
            const sessionManager = new SessionManager();

            // æ£€æµ‹ç§»åŠ¨ç«¯
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                const mobileTips = document.getElementById('mobileTips');
                if (mobileTips) {
                    mobileTips.style.display = 'block';
                }
            }

            // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½SDK
            if (window.CozeWebSDK) {
                console.log('SDKå·²åŠ è½½ï¼Œç›´æ¥åˆå§‹åŒ–');
                initializeCoze();
                return;
            }

            let sdkLoaded = false;
            
            // å°è¯•å¤šä¸ªSDKæº
            const sdkSources = [
                'https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.19/libs/cn/index.js', // å®˜æ–¹æº1
                'https://lf-cdn.coze.cn/obj/unpkg/coze-web-sdk/coze-sdk.min.js', // å®˜æ–¹æº2
                'https://lf3-cdn-tos.douyinstatic.com/obj/coze-web-sdk/coze-sdk.min.js' // å¤‡ç”¨æº
            ];
            
            function tryLoadSDK(sourceIndex = 0) {
                if (sourceIndex >= sdkSources.length) {
                    statusEl.innerHTML = 'âŒ æ‰€æœ‰SDKæºåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                    showFallbackChatInterface();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sdkSources[sourceIndex];
                script.crossOrigin = 'anonymous';
                
                statusEl.innerHTML = `æ­£åœ¨åŠ è½½SDK...<span class="loading-dots"></span>`;
                
                const timeout = 15000; // 15ç§’è¶…æ—¶
                const loadTimer = setTimeout(() => {
                    if (!sdkLoaded) {
                        script.remove();
                        console.warn(`SDKæº ${sdkSources[sourceIndex]} åŠ è½½è¶…æ—¶ï¼Œå°è¯•ä¸‹ä¸€ä¸ª`);
                        tryLoadSDK(sourceIndex + 1);
                    }
                }, timeout);

                script.onload = function() {
                    clearTimeout(loadTimer);
                    sdkLoaded = true;
                    cozeSDKLoaded = true;
                    console.log(`âœ… SDKåŠ è½½æˆåŠŸ: ${sdkSources[sourceIndex]}`);
                    
                    // ç­‰å¾…SDKå®Œå…¨åˆå§‹åŒ–
                    setTimeout(() => {
                        if (window.CozeWebSDK) {
                            statusEl.innerHTML = 'SDKåŠ è½½æˆåŠŸï¼Œæ­£åœ¨åˆå§‹åŒ–ç”¨æˆ·ä¼šè¯<span class="loading-dots"></span>';
                            initializeCoze();
                        } else {
                            console.error('SDKåŠ è½½ä½†æœªå®šä¹‰ï¼Œå°è¯•ä¸‹ä¸€ä¸ªæº');
                            tryLoadSDK(sourceIndex + 1);
                        }
                    }, 500);
                };

                script.onerror = function() {
                    clearTimeout(loadTimer);
                    console.warn(`âŒ SDKæº ${sdkSources[sourceIndex]} åŠ è½½å¤±è´¥`);
                    tryLoadSDK(sourceIndex + 1);
                };

                document.head.appendChild(script);
            }
            
            // å¼€å§‹åŠ è½½ç¬¬ä¸€ä¸ªSDKæº
            tryLoadSDK(0);
        }

        // ========== å¤‡ç”¨èŠå¤©ç•Œé¢ ==========
        function showFallbackChatInterface() {
            const fallbackHTML = `
                <div class="panel-section" style="background: #fff8e1; border-left: 4px solid #ff9800; margin-top: 20px;">
                    <h3 style="color: #ff9800;">å¤‡ç”¨èŠå¤©ç•Œé¢</h3>
                    <p>Cozeæ™ºèƒ½ä½“æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·å°è¯•ï¼š</p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>åˆ·æ–°é¡µé¢é‡æ–°åŠ è½½</li>
                        <li>æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å±è”½äº†æ‚¬æµ®æŒ‰é’®</li>
                        <li>å…è®¸é¡µé¢æ˜¾ç¤ºå¼¹çª—å’Œæ‚¬æµ®å…ƒç´ </li>
                        <li>è”ç³»æŠ€æœ¯æ”¯æŒ</li>
                    </ol>
                    <button onclick="window.location.reload()" style="
                        background: #1a73e8;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 4px;
                        cursor: pointer;
                        margin-top: 15px;
                    ">é‡æ–°åŠ è½½</button>
                </div>
            `;
            
            const contentArea = document.querySelector('.content-area');
            if (contentArea) {
                contentArea.insertAdjacentHTML('beforeend', fallbackHTML);
            }
        }

        // ========== æ‰‹åŠ¨æ˜¾ç¤ºæ‚¬æµ®æŒ‰é’®ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰ ==========
        function createManualChatButton() {
            // å¦‚æœSDKåŠ è½½å¤±è´¥ï¼Œåˆ›å»ºæ‰‹åŠ¨æŒ‰é’®
            const manualButton = document.createElement('button');
            manualButton.id = 'manual-coze-button';
            manualButton.innerHTML = 'ğŸ’¬';
            manualButton.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 30px;
                width: 60px;
                height: 60px;
                background-color: #1a73e8;
                border: none;
                border-radius: 50%;
                color: white;
                font-size: 24px;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                transition: all 0.3s;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            manualButton.addEventListener('click', function() {
                alert('Cozeæ™ºèƒ½ä½“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚');
            });
            
            document.body.appendChild(manualButton);
            
            // æ·»åŠ æ‚¬åœæ•ˆæœ
            manualButton.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.1)';
                this.style.backgroundColor = '#a9c8f5';
            });
            
            manualButton.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
                this.style.backgroundColor = '#1a73e8';
            });
        }

        // ========== é¡µé¢åŠ è½½ ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ä¸ªæ€§åŒ–ä¼šè¯ç³»ç»Ÿ');
            
            // å…ˆåˆ›å»ºä¼šè¯ç®¡ç†å™¨
            const sessionManager = new SessionManager();
            
            // å»¶è¿ŸåŠ è½½SDKï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½
            setTimeout(() => {
                loadCozeSDK();
                
                // 10ç§’åæ£€æŸ¥SDKæ˜¯å¦åŠ è½½æˆåŠŸ
                setTimeout(() => {
                    if (!cozeSDKLoaded && !window.CozeWebSDK) {
                        console.warn('SDKåŠ è½½è¶…æ—¶ï¼Œæ˜¾ç¤ºå¤‡ç”¨æ–¹æ¡ˆ');
                        const statusEl = document.getElementById('status');
                        if (statusEl) {
                            statusEl.innerHTML = 'âš ï¸ SDKåŠ è½½è¾ƒæ…¢ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ...';
                        }
                        createManualChatButton();
                    }
                }, 10000);
            }, 1000);
        });

        // ========== é”™è¯¯å¤„ç† ==========
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€é”™è¯¯:', e.error);
            const statusEl = document.getElementById('status');
            if (statusEl) {
                statusEl.innerHTML = 'âŒ å‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
            }
        });

        // ========== è°ƒè¯•åŠŸèƒ½ ==========
        window.debugCoze = function() {
            console.log('=== Cozeè°ƒè¯•ä¿¡æ¯ ===');
            console.log('1. SDKæ˜¯å¦åŠ è½½:', !!window.CozeWebSDK);
            console.log('2. SDKç‰ˆæœ¬:', window.CozeWebSDK ? 'å·²åŠ è½½' : 'æœªåŠ è½½');
            console.log('3. ä¼šè¯ä¿¡æ¯:', new SessionManager().session);
            console.log('4. Cozeå®¢æˆ·ç«¯å®ä¾‹:', window.cozeClientInstance);
            console.log('5. æ‰€æœ‰Cozeç›¸å…³å…ƒç´ :', 
                document.querySelectorAll('[class*="coze"], [class*="Coze"], [id*="coze"], [id*="Coze"]'));
            console.log('6. iframeæ•°é‡:', document.querySelectorAll('iframe').length);
            console.log('=== è°ƒè¯•ç»“æŸ ===');
            
            // å¼ºåˆ¶æ£€æŸ¥æŒ‰é’®
            checkForChatButton();
        };
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®è°ƒè¯•
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                window.debugCoze();
            }
        });
    </script>
</body>
</html>
